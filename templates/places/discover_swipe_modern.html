{% extends 'base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}Keşfet - MekanKeşif{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/swipe_modern.css' %}?v=3.5">
<link rel="stylesheet" href="{% static 'css/swipe_rich.css' %}">
<style>
/* Critical inline styles */
body.swipe-page,
body.swipe-page * {
    box-sizing: border-box;
}

body.swipe-page .navbar,
body.swipe-page footer,
body.swipe-page nav,
body.swipe-page .navbar-collapse {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
}

body.swipe-page .container {
    padding: 0 !important;
    margin: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
}

body.swipe-page main {
    padding: 0 !important;
    margin: 0 !important;
    background: transparent !important;
}

/* Dark Mode Tema - Discover sayfası gibi */
body.swipe-page {
    background: #111827 !important;
    color: #f9fafb !important;
}

body.swipe-page .swipe-container {
    background: #111827 !important;
}

body.swipe-page .swipe-top-bar {
    background: #1f2937 !important;
    border-bottom: 1px solid #374151 !important;
    color: #f9fafb !important;
}

body.swipe-page .swipe-top-bar .back-btn {
    background: #374151 !important;
    color: #f9fafb !important;
}

body.swipe-page .swipe-top-bar .back-btn:hover {
    background: #4b5563 !important;
}

body.swipe-page .swipe-top-bar .page-title {
    color: #f9fafb !important;
}

body.swipe-page .swipe-top-bar .stat-badge {
    background: #374151 !important;
    color: #f9fafb !important;
}

body.swipe-page .swipe-top-bar .stat-badge i {
    color: #fbbf24 !important;
}

/* Discover sayfası kart tasarımı - Swipe kartlarına uygula */
.swipe-card .card-cover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.swipe-card .card-banner {
    height: 50vh;
    min-height: 400px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    overflow: hidden;
}

.swipe-card .card-banner-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.swipe-card .card-banner::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.3) 100%);
    pointer-events: none;
}

.swipe-card .card-header {
    background: #1f2937;
    padding: 32px;
    padding-bottom: 24px;
}

body.swipe-page .swipe-card .card-header {
    background: #1f2937 !important;
}

.swipe-card .card-title {
    font-size: 28px;
    font-weight: 700;
    color: #f9fafb;
    margin-bottom: 12px;
    line-height: 1.3;
    letter-spacing: -0.5px;
}

body.swipe-page .swipe-card .card-title {
    color: #f9fafb !important;
}

.swipe-card .card-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
    font-size: 14px;
    color: #d1d5db;
}

body.swipe-page .swipe-card .card-meta {
    color: #d1d5db !important;
}

.swipe-card .card-rating {
    display: flex;
    align-items: center;
    gap: 6px;
}

.swipe-card .card-rating-stars {
    color: #fbbf24;
    font-size: 16px;
    letter-spacing: 2px;
}

.swipe-card .card-rating-stars .bi-star-fill,
.swipe-card .card-rating-stars .bi-star-half {
    color: #fbbf24;
}

.swipe-card .card-rating-stars .bi-star {
    color: #e5e7eb;
}

.swipe-card .card-rating-numeric {
    font-weight: 600;
    color: #f9fafb;
}

body.swipe-page .swipe-card .card-rating-numeric {
    color: #f9fafb !important;
}

.swipe-card .card-subtitle {
    font-size: 15px;
    line-height: 1.6;
    color: #d1d5db;
    font-style: italic;
}

body.swipe-page .swipe-card .card-subtitle {
    color: #d1d5db !important;
}

.swipe-card .card-content {
    background: #1f2937;
    padding: 0 24px 40px;
}

body.swipe-page .swipe-card .card-content {
    background: #1f2937 !important;
}

.swipe-card .card-section {
    margin-bottom: 32px;
}

.swipe-card .card-section-title {
    font-size: 18px;
    font-weight: 700;
    color: #f9fafb;
    margin-bottom: 16px;
    letter-spacing: 0.3px;
}

body.swipe-page .swipe-card .card-section-title {
    color: #f9fafb !important;
}

.swipe-card .card-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.swipe-card .card-chip {
    padding: 10px 16px;
    background: #374151;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 500;
    color: #f9fafb;
    border: none;
    transition: all 0.2s ease;
    text-transform: capitalize;
}

body.swipe-page .swipe-card .card-chip {
    background: #374151 !important;
    color: #f9fafb !important;
}

.swipe-card .card-chip:hover {
    background: #4b5563;
    transform: translateY(-1px);
}

body.swipe-page .swipe-card .card-chip:hover {
    background: #4b5563 !important;
}

.swipe-card .card-chip-feature {
    background: rgba(217, 178, 78, 0.1);
    color: #D9B24E;
}

.swipe-card .card-chip-feature:hover {
    background: rgba(217, 178, 78, 0.2);
}

@media (min-width: 768px) {
    .swipe-card .card-header {
        padding: 48px;
        padding-bottom: 32px;
    }
    
    .swipe-card .card-content {
        padding: 0 48px 60px;
        max-width: 800px;
        margin: 0 auto;
    }
}

@media (max-width: 480px) {
    .swipe-card .card-banner {
        height: 40vh;
        min-height: 300px;
    }
    
    .swipe-card .card-title {
        font-size: 24px;
    }
    
    .swipe-card .card-section-title {
        font-size: 16px;
    }
    
    .swipe-card .card-header {
        padding: 24px;
    }
    
    .swipe-card .card-content {
        padding: 0 24px 32px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/swipe_card_builder.js' %}?v=3.6"></script>
<script src="{% static 'js/swipe_modern.js' %}?v=3.4"></script>
<script>
// Debug: Check if new code is loaded
console.log('Swipe page loaded - v2.0');
if (typeof SwipeCardBuilder !== 'undefined') {
    console.log('✓ SwipeCardBuilder loaded');
} else {
    console.error('✗ SwipeCardBuilder NOT loaded');
}

// Bu sayfada body'ye özel sınıf ekle (layout sadece swipe'ta değişsin)
document.addEventListener('DOMContentLoaded', function () {
    document.body.classList.add('swipe-page');
});
</script>
{% endblock %}

{% block content %}
<!-- Global Overlays -->
<div class="overlay-like">✓</div>
<div class="overlay-nope">✗</div>
<div class="overlay-save">★</div>

<!-- Minimal Top Bar -->
<div class="swipe-top-bar">
    <a href="{% url 'places:discover' %}" class="back-btn">
        <i class="bi bi-chevron-left"></i>
    </a>
    <div class="top-bar-center">
        <span class="page-title">Keşfet</span>
    </div>
    <div class="top-bar-stats">
        <div class="stat-badge" id="statLikes">
            <i class="bi bi-heart"></i>
            <span id="likesCount">0</span>
        </div>
        <div class="stat-badge" id="statSaves">
            <i class="bi bi-bookmark"></i>
            <span id="savesCount">0</span>
        </div>
    </div>
</div>

<!-- Swipe Container -->
<div class="swipe-container">
    <div class="cards-stack" id="cardsStack">
        <!-- Cards will be loaded here -->
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" id="actionButtons" style="display: none;">
        <button class="action-btn btn-nope" onclick="swipeCard('dislike')" title="Beğenme">
            <i class="bi bi-x-lg"></i>
        </button>
        <button class="action-btn btn-save" onclick="swipeCard('save')" title="Kaydet">
            <i class="bi bi-bookmark"></i>
        </button>
        <button class="action-btn btn-detail" onclick="showDetail()" title="Detay">
            <i class="bi bi-info-circle"></i>
        </button>
        <button class="action-btn btn-like" onclick="swipeCard('like')" title="Beğen">
            <i class="bi bi-heart-fill"></i>
        </button>
    </div>

    <!-- Card Counter -->
    <div class="card-counter" id="cardCounter" style="display: none;">
        <span id="currentCardIndex">0</span>/<span id="totalCards">0</span>
    </div>
</div>

<!-- Harita Modal -->
<div id="mapModal" class="map-modal">
    <div class="map-modal-content">
        <div class="map-modal-header">
            <h3 id="mapModalTitle">Haritada Göster</h3>
            <button class="map-modal-close" onclick="closeMapModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="map-modal-body">
            <div id="mapContainer" class="map-container"></div>
            <div class="map-info">
                <div id="mapPlaceInfo" class="map-place-info"></div>
                <div class="map-actions">
                    <button id="btnGetRoute" class="btn-get-route" onclick="getRoute()">
                        <i class="bi bi-signpost"></i> Rota Al
                    </button>
                    <button id="btnShowNearby" class="btn-show-nearby" onclick="showNearbyPlaces()">
                        <i class="bi bi-geo-alt"></i> Yakındakileri Göster
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY|default:"AIzaSyDummyKey" }}&libraries=places,directions" async defer></script>
<script src="{% static 'js/map_integration.js' %}?v=1.0"></script>
{% endblock %}
